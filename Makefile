#
# DO NOT EDIT THIS FILE!!!  Edit .\sources. if you want to add a new source
# file to this component.  This file merely indirects to the real make file
# that is shared by all the driver components of the Windows NT DDK
#

BUILD_DEFAULT=-cegiw -nmake -i

!INCLUDE $(NTMAKEENV)\makefile.def

publish: p:\utils\zerodrv.exe p:\utils\zerodrv_source.7z

p:\utils\zerodrv.exe: p:\utils\7zSD.sfx zero.7zsfxcfg zero.7z
	copy /b p:\utils\7zSD.sfx + zero.7zsfxcfg + zero.7z p:\utils\zerodrv.exe
	signtool sign /a /v /n "Lagerkvist Teknisk Rådgivning i Borås HB" /du "http://www.ltr-data.se" /ac "z:\kod\cert\GlobalSign Root CA.crt" /t "http://timestamp.globalsign.com/scripts/timestamp.dll" /d "Zero and Random Device Driver" p:\utils\zerodrv.exe
	xcopy p:\utils\zerodrv.exe z:\ltr-website\ltr-data.se\files\ /d/y

zero.7z: i386\zero.sys ia64\zero.sys amd64\zero.sys zero.inf install.cmd run64.exe Makefile
#	signtool sign /v /s PrivateCertStore /n ltr-data.se(Test) /d "Zero and Random Device Driver" /du "http://www.ltr-data.se" /t "http://timestamp.verisign.com/scripts/timestamp.dll" i386\zero.sys ia64\zero.sys amd64\zero.sys
#	signtool sign /a /v /n "Lagerkvist Teknisk Rådgivning i Borås HB" /du "http://www.ltr-data.se" /ac "z:\kod\cert\GlobalSign Root CA.crt" /t "http://timestamp.globalsign.com/scripts/timestamp.dll" /d "Zero and Random Device Driver" i386\zero.sys ia64\zero.sys amd64\zero.sys
	7z a zero.7z -m0=LZMA:a=2 i386\zero.sys ia64\zero.sys amd64\zero.sys zero.inf install.cmd run64.exe

p:\utils\zerodrv_source.7z: zero.7z
	del p:\utils\zerodrv_source.7z
	7z a -r p:\utils\zerodrv_source.7z -m0=PPMd install.cmd Makefile Sources zero.7zsfxcfg zero.c zero.inf
	xcopy p:\utils\zerodrv_source.7z z:\ltr-website\ltr-data.se\files\ /d/y
